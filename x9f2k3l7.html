<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Handout Chat</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: #111;
    color: #eee;
    font-family: "Segoe UI", sans-serif;
  }
  .chat-container {
    max-width: 600px;
    margin: 40px auto;
    padding: 20px;
  }
  .message {
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.6s ease, transform 0.6s ease;
    margin: 16px 0;
    background: #222;
    padding: 12px 16px;
    border-radius: 8px;
    line-height: 1.6;
    white-space: pre-line;
  }
  .message.visible {
    opacity: 1;
    transform: translateY(0);
  }
  .typing {
    display: inline-block;
    font-weight: normal;
  }
  .typing::after {
    content: '6'; /* … */
    animation: blink 1s infinite steps(1);
  }
  @keyframes blink {
    0% { opacity: 0; }
    50% { opacity: 1; }
    100% { opacity: 0; }
  }
.typing::after {
    content: "typing...";
    animation: blink 1s steps(1,end) infinite;
}
@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}
</style>
</head>
<body>
<div class="chat-container" id="chat"></div>

<script>
  // sequence: text, optional delay before typing, typing duration (ms)
  const sequence = [
    { text: "anonymous: やあ、遺書屋さん。久しぶり。", delay: 0, typing: 0 },
    { text: "anonymous: このチャットに来たってことは、依頼を受けてくれたってことでいいんだよね。ありがとう", delay: 1000, typing: 500 },
    { text: "anonymous: さて、依頼内容なんだけど。同封したチケットでクルーズ船に乗って、ある人に荷物を届けて欲しい。\n荷物は出港当日12時に(35.443946266776194, 139.65253930773477)で受け渡す。", delay: 2000, typing: 2000 },
    { text: "anonymous: 殺人の依頼じゃなくてごめんね？でも、今回もちょっと厄介なことになりそうでね。\nできれば荒事にも対応できる人にお願いしたいんだ。もちろん、報酬は弾むよ。", delay: 2000, typing: 1500 },
    { text: "anonymous: ちなみに、今回のクルーズはハロウィン仕様だそうだよ。\nつくづく君たちは冥界に縁があるね(笑)", delay: 3000, typing: 1000 },
    { text: "anonymous: 荷物届けちゃったら暇だろうし、折角だから楽しんできてよ。1年前みたいにね。", delay: 1000, typing: 500 }
  ];

  const chat = document.getElementById("chat");

  function showTypingIndicator() {
    const div = document.createElement("div");
    div.className = "message";
    div.innerHTML = '<span class="typing"></span>';
    chat.appendChild(div);
    // ensure it's rendered before adding visible
    setTimeout(() => div.classList.add("visible"), 20);
    // scroll to bottom so typing is visible
    window.scrollTo(0, document.body.scrollHeight);
    return div;
  }

  function showMessage(text) {
    const div = document.createElement("div");
    div.className = "message";
    div.textContent = text;
    chat.appendChild(div);
    setTimeout(() => div.classList.add("visible"), 20);
    window.scrollTo(0, document.body.scrollHeight);
  }

  async function playSequence() {
    for (const item of sequence) {
      if (item.delay) await new Promise(r => setTimeout(r, item.delay));
      const typingDiv = showTypingIndicator();
      if (item.typing) await new Promise(r => setTimeout(r, item.typing));
      typingDiv.remove();
      showMessage(item.text);
    }
  }

  // start
  playSequence();
</script>
</body>
</html>
